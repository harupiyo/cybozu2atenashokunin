cybozu2atenashokunin
====================

サイボウズ(R) Office のアドレス帳からエクスポートしたCSV を
宛名職人でラベル出力のためにインポートできるように変換するツール

動作確認したバージョン
----------------------
* perl v5.12.3
* サイボウズ(R) Office Version 8.0.1
* 宛名職人2004

インストール
------------
以下のCPAN モジュールを事前にインストールしておいて下さい。
* Text::CSV::Encoded;
* List::MoreUtils;
* Getopt::Long;

使い方
------

1. 変換準備：サイボウズからCSV データのダウンロード

サイボウズからエクスポートしたCSV をこのスクリプトと同じフォルダに用意して下さい。
（addressperson.csv のファイル名で、文字コードはshift-jis(CP932) のもの）

2. スクリプトの実行

$ perl cybozu2atenashokunin.pl > atena.csv 2> warn

ここでできる"atena.csv" は宛名職人に取り込むためのファイルです。
変換の中で検出した警告は"warn ファイル" に格納されます。

出力するファイルの文字コードはいずれもshift-jis(CP932) です。

3. 生成されたatena.csv を確認

ラベル出力に差支えのある問題が"warn ファイル" に出力されていますので適宜データの訂正を行って下さい。

メモ：
    そもそもサイボウズ上で不適切なデータが登録されている可能性もあると思います。
    目視チェックを行う事をオススメします。
    例）
        重複
        OCR での取り込み時の誤字、脱字
        住所や所属が古い

4. 宛名職人にインポート

完成したatena.csv を取り込んで、ラベル印刷して下さい。

宛名職人2004 での方法（取り込むまで）を紹介します。
    アイコンメニューから[データ読み込み]-[CSV(カンマ区切り)形式(*.csv)]
    読み込むファイルを指定し、読みこむ先を選択する。
    [自動割付(O)] を選ぶと、適宜読み込み対象項目に割り当てられることを目指確認。
    [実行(G)] で実際に取り込まれる。

なお、最初の１件には項目名が入っていますので、削除しておいて下さい。
    [一覧表示]-右クリックメニュー-[カードの切り取り(X)]


おまけ機能：面識確認
--------------------

ラベルを印刷する前に、面識があるかどうかを社員にチェックしてもらうためのCSV を出力できます。

$ perl cybozu2atenashokunin.pl --confirm > confirm.csv

このcsv をGoogle Docs 等で回覧し、面識のある人には２カラム目に◯文字（文字はなんでもいい。空白でなければ取り込み対象となる）を入れてもらうようにして下さい。
面識の確認のみが目的なので、住所等細かな情報は入っていません。

なお１カラム目のuid には数字が入っていますが、これは絶対に変更しないで下さい。
この番号とaddressperson.csv の行番号を対応させて処理します。
同様の理由でconfirm.csv を作った時のaddressperson.csv を使って次の処理を行なって下さい。

回覧できたら"flag.csv" という名前でエクスポートし、スクリプトと同じフォルダに用意して下さい。
その上で--with-flag-file のオプションをつけて変換処理を実行します。

$ perl cybozu2atenashokunin.pl --with-flag-file > atena.csv 2> warn

これで面識のある人のみのatena.csv が出力されました。

仕様
----
サイボウズから出力した addressperson.csv を元に処理
    addressperson.csv の仕様
        最初の一行は項目名が記述されているものとする
        フィールド順：
            "名前（姓）","名前（名）","よみ（姓）","よみ（名）",
            "E-mail","連名","自宅〒","自宅住所１","自宅住所２",
            "自宅住所３","自宅TEL","自宅FAX","自宅携帯","会社〒",
            "会社住所１","会社住所２","会社住所３","会社TEL",
            "会社FAX","会社携帯","会社名フリガナ","会社名","部署１",
            "部署２","役職名","メモ１","担当者","担当部署","会社コード",
            "会社名","部課","会社よみ","郵便番号","住所","会社Tel",
            "会社Fax","URL","担当者","担当部署",""

出力はラベル出力に必要な項目だけ。完全にデータを移行することは目指していない。

サイボウズのアドレス帳には「個人情報」「会社情報」のエリアがあるが、
    会社情報 > 個人情報の会社情報 > 個人情報の自宅住所情報
の優先度で択一選択する。
    
部課に情報が入っている場合はそれを、入っていない場合は部署1, 部署2 を使おうとする。

必須項目チェック
    名前
    郵便番号
    住所/会社住所1/自宅住所1
宛名職人側で取り込める長さかチェックに違反したら警告を出す項目
    会社名
    部課/部署１
    住所/会社住所1/自宅住所1
    会社住所2/自宅住所2
    会社住所3/自宅住所3

AUTHOR
------
harupiyo <harupiyo[at]gmail[dot]com>
株式会社アジャスト http://www.adjust.ne.jp/

COPYRIGHT AND LICENSE
---------------------

Copyright 2012 by harupiyo

このスクリプトはPerl 本体と同じライセンスの元で発行します。
This script is free software; you can redistribute it and/or modify it
under the same terms as Perl itself.
